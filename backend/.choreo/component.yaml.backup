# Choreo Component Configuration
schemaVersion: 1.2
apiVersion: core.choreo.dev/v1beta1
kind: Component
metadata:
  name: cyclesync-backend
  displayName: CycleSync Backend Services
  description: Circular economy platform backend with multiple microservices
  version: 0.1.0
  tags:
    - circular-economy
    - recycling
    - sri-lanka
    - ballerina

spec:
  type: service
  buildPreset: ballerina
  
  # Build configuration for Ballerina
  build:
    buildContext: .
    ballerinaVersion: "2201.8.5"
  
  # Service endpoints
  endpoints:
    - name: api
      port: 8080
      type: REST
      networkVisibility: Public
  
  # Environment variables
  envVars:
    - name: DB_HOST
      type: secret
      description: PostgreSQL database host
      
    - name: DB_PASSWORD
      type: secret
      description: PostgreSQL database password
      
    - name: GEMINI_API_KEY
      type: secret
      description: Google Gemini API key
      
    - name: GOOGLE_VISION_API_KEY
      type: secret
      description: Google Vision API key
      
    - name: ASGARDEO_CLIENT_SECRET
      type: secret
      description: Asgardeo OAuth client secret
      
    - name: JWT_SECRET
      type: secret
      description: JWT signing secret
      
    - name: DB_PORT
      type: plain
      defaultValue: "5432"
      
    - name: DB_USERNAME
      type: plain
      description: Database username
      
    - name: DB_NAME
      type: plain
      defaultValue: "cyclesync_db"
      
    - name: ENVIRONMENT
      type: plain
      defaultValue: "production"
  
  # Health check
  healthCheck:
    path: /health
    port: 9090
    intervalSeconds: 30
    timeoutSeconds: 10
  
  # Resource requirements
  resources:
    requests:
      memory: 512Mi
      cpu: 0.5
    limits:
      memory: 2Gi
      cpu: 2.0
  
  # Scaling
  scaling:
    minReplicas: 1
    maxReplicas: 5
    metrics:
      - type: cpu
        targetAverageUtilization: 70
      - type: memory
        targetAverageUtilization: 80